<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reading - EEL</title>
    <link rel="stylesheet" href="css/styles.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/lucide/0.263.1/lucide.min.css" rel="stylesheet">
</head>
<body>
    <!-- Loading Screen -->
    <div id="loading-screen" class="loading-screen">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <p>Loading Reading...</p>
        </div>
    </div>

    <!-- Main Application Layout -->
    <div id="main-app" class="flex h-screen bg-background hidden">
        <!-- Sidebar -->
        <div id="sidebar" class="w-64 bg-sidebar border-r border-sidebar-border h-full flex flex-col">
            <div class="p-6">
                <h1 id="sidebar-title" class="text-xl font-semibold">EEL</h1>
                <p id="sidebar-welcome" class="text-sm text-muted-foreground mt-1">Welcome</p>
            </div>
            <nav id="sidebar-nav" class="flex-1 px-4 space-y-2"></nav>
            <div class="p-4">
                <button id="logout-btn" class="w-full p-3 border border-sidebar-border bg-transparent text-sidebar-foreground rounded-md hover:bg-sidebar-accent hover:text-sidebar-accent-foreground transition-all flex items-center justify-center gap-2">
                    <i data-lucide="log-out"></i>
                    Logout
                </button>
            </div>
        </div>

        <!-- Main Content -->
        <main class="flex-1 overflow-auto">
            <div class="p-6">
                <!-- Breadcrumb -->
                <div id="breadcrumb"></div>

                <!-- Dynamic Content -->
                <div id="main-content">
                    <!-- Content populated by JavaScript based on user role -->
                </div>
            </div>
        </main>
    </div>

    <!-- Scripts -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/navigation.js"></script>

    <script>
        // Reading page controller
        class ReadingPage {
            constructor() {
                this.currentUser = null;
                this.currentLesson = null;
                this.init();
            }

            async init() {
                // Check authentication
                if (!isAuthenticated()) {
                    window.location.href = '/login.html';
                    return;
                }

                this.currentUser = getCurrentUser();
                this.setupUI();
                this.renderContent();
                
                setTimeout(() => {
                    document.getElementById('loading-screen').classList.add('hidden');
                    document.getElementById('main-app').classList.remove('hidden');
                    lucide.createIcons();
                }, 500);
            }

            setupUI() {
                // Setup sidebar and breadcrumb
                Navigation.setupSidebar(this.currentUser, 'reading');
                document.getElementById('breadcrumb').innerHTML = 
                    Navigation.renderBreadcrumb(this.currentUser, 'reading');
                
                // Bind logout
                document.getElementById('logout-btn').addEventListener('click', () => {
                    logout();
                    window.location.href = '/login.html';
                });
            }

            renderContent() {
                const content = this.currentUser.role === 'teacher' 
                    ? this.getTeacherContent() 
                    : this.getStudentContent();
                
                document.getElementById('main-content').innerHTML = content;
                
                // Bind events after content is rendered
                setTimeout(() => this.bindEvents(), 100);
            }

            getTeacherContent() {
                return `
                    <!-- Header -->
                    <div class="mb-8">
                        <h2 class="text-2xl font-semibold mb-2">Reading Lessons</h2>
                        <p class="text-muted-foreground">Create and manage reading comprehension lessons for your students</p>
                    </div>

                    <!-- Action Bar -->
                    <div class="flex flex-wrap gap-4 mb-6">
                        <button id="create-lesson" class="btn btn-primary">
                            <i data-lucide="plus" class="size-4 mr-2"></i>
                            Create New Lesson
                        </button>
                        <button id="import-text" class="btn btn-outline">
                            <i data-lucide="upload" class="size-4 mr-2"></i>
                            Import Text
                        </button>
                        <button id="ai-generate" class="btn btn-outline">
                            <i data-lucide="brain" class="size-4 mr-2"></i>
                            AI Generate
                        </button>
                        <button id="bulk-upload" class="btn btn-outline">
                            <i data-lucide="folder-plus" class="size-4 mr-2"></i>
                            Bulk Upload
                        </button>
                    </div>

                    <!-- Statistics Cards -->
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
                        <div class="card bg-gradient-to-br from-primary/5 to-primary/10 border-primary/20">
                            <div class="card-content p-4">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm text-muted-foreground">Total Lessons</p>
                                        <p class="text-2xl font-bold text-primary">24</p>
                                    </div>
                                    <i data-lucide="book-open" class="size-8 text-primary/60"></i>
                                </div>
                            </div>
                        </div>
                        <div class="card bg-gradient-to-br from-secondary/5 to-secondary/10 border-secondary/20">
                            <div class="card-content p-4">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm text-muted-foreground">Active Lessons</p>
                                        <p class="text-2xl font-bold text-secondary">12</p>
                                    </div>
                                    <i data-lucide="play-circle" class="size-8 text-secondary/60"></i>
                                </div>
                            </div>
                        </div>
                        <div class="card bg-gradient-to-br from-primary/5 to-primary/10 border-primary/20">
                            <div class="card-content p-4">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm text-muted-foreground">Avg. Score</p>
                                        <p class="text-2xl font-bold text-primary">87%</p>
                                    </div>
                                    <i data-lucide="trending-up" class="size-8 text-primary/60"></i>
                                </div>
                            </div>
                        </div>
                        <div class="card bg-gradient-to-br from-secondary/5 to-secondary/10 border-secondary/20">
                            <div class="card-content p-4">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm text-muted-foreground">Completions</p>
                                        <p class="text-2xl font-bold text-secondary">342</p>
                                    </div>
                                    <i data-lucide="check-circle" class="size-8 text-secondary/60"></i>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Lessons Grid -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        ${this.getTeacherLessons().map(lesson => `
                            <div class="card group cursor-pointer hover:shadow-lg transition-all duration-300 hover:-translate-y-1" data-lesson-id="${lesson.id}">
                                <div class="card-content p-6">
                                    <div class="flex items-center justify-between mb-4">
                                        <span class="px-2 py-1 text-xs rounded ${lesson.level === 'Beginner' ? 'bg-green-100 text-green-800' : lesson.level === 'Intermediate' ? 'bg-yellow-100 text-yellow-800' : 'bg-red-100 text-red-800'}">${lesson.level}</span>
                                        <div class="flex gap-1">
                                            <button class="opacity-0 group-hover:opacity-100 transition-opacity p-1 hover:bg-accent rounded" onclick="event.stopPropagation(); editLesson(${lesson.id})">
                                                <i data-lucide="edit" class="size-4"></i>
                                            </button>
                                            <button class="opacity-0 group-hover:opacity-100 transition-opacity p-1 hover:bg-destructive/10 text-destructive rounded" onclick="event.stopPropagation(); deleteLesson(${lesson.id})">
                                                <i data-lucide="trash-2" class="size-4"></i>
                                            </button>
                                        </div>
                                    </div>
                                    <h3 class="font-semibold mb-2">${lesson.title}</h3>
                                    <p class="text-sm text-muted-foreground mb-4">${lesson.description}</p>
                                    <div class="flex items-center justify-between text-xs text-muted-foreground mb-4">
                                        <span><i data-lucide="clock" class="size-3 mr-1"></i>${lesson.readTime}</span>
                                        <span><i data-lucide="help-circle" class="size-3 mr-1"></i>${lesson.questions} questions</span>
                                        <span><i data-lucide="users" class="size-3 mr-1"></i>${lesson.students} students</span>
                                    </div>
                                    <div class="flex gap-2">
                                        <button class="btn btn-outline flex-1 group-hover:bg-primary group-hover:text-primary-foreground transition-colors">
                                            <i data-lucide="edit" class="size-3 mr-1"></i>
                                            Edit
                                        </button>
                                        <button class="btn btn-outline" onclick="event.stopPropagation(); viewResults(${lesson.id})">
                                            <i data-lucide="bar-chart-3" class="size-3"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
            }

            getStudentContent() {
                return `
                    <!-- Header -->
                    <div class="mb-8">
                        <h2 class="text-2xl font-semibold mb-2">Reading Practice</h2>
                        <p class="text-muted-foreground">Improve your reading comprehension skills with interactive lessons</p>
                    </div>

                    <!-- Progress Overview -->
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
                        <div class="card bg-gradient-to-br from-primary/5 to-primary/10 border-primary/20">
                            <div class="card-content p-4">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm text-muted-foreground">Lessons Completed</p>
                                        <p class="text-2xl font-bold text-primary">12</p>
                                    </div>
                                    <i data-lucide="book-open" class="size-8 text-primary/60"></i>
                                </div>
                            </div>
                        </div>
                        <div class="card bg-gradient-to-br from-secondary/5 to-secondary/10 border-secondary/20">
                            <div class="card-content p-4">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm text-muted-foreground">Average Score</p>
                                        <p class="text-2xl font-bold text-secondary">85%</p>
                                    </div>
                                    <i data-lucide="target" class="size-8 text-secondary/60"></i>
                                </div>
                            </div>
                        </div>
                        <div class="card bg-gradient-to-br from-primary/5 to-primary/10 border-primary/20">
                            <div class="card-content p-4">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm text-muted-foreground">Reading Streak</p>
                                        <p class="text-2xl font-bold text-primary">7</p>
                                    </div>
                                    <i data-lucide="flame" class="size-8 text-primary/60"></i>
                                </div>
                            </div>
                        </div>
                        <div class="card bg-gradient-to-br from-secondary/5 to-secondary/10 border-secondary/20">
                            <div class="card-content p-4">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm text-muted-foreground">Next Level</p>
                                        <p class="text-2xl font-bold text-secondary">3</p>
                                    </div>
                                    <i data-lucide="arrow-up" class="size-8 text-secondary/60"></i>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Available Lessons -->
                    <div class="mb-6">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-lg font-semibold">Available Lessons</h3>
                            <div class="flex gap-2">
                                <select id="difficulty-filter" class="px-3 py-1 border border-border rounded-md text-sm">
                                    <option value="all">All Levels</option>
                                    <option value="beginner">Beginner</option>
                                    <option value="intermediate">Intermediate</option>
                                    <option value="advanced">Advanced</option>
                                </select>
                                <select id="topic-filter" class="px-3 py-1 border border-border rounded-md text-sm">
                                    <option value="all">All Topics</option>
                                    <option value="science">Science</option>
                                    <option value="history">History</option>
                                    <option value="literature">Literature</option>
                                    <option value="current-events">Current Events</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Lessons Grid -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        ${this.getStudentLessons().map(lesson => `
                            <div class="card group cursor-pointer hover:shadow-lg transition-all duration-300 hover:-translate-y-1" data-lesson-id="${lesson.id}" onclick="startLesson(${lesson.id})">
                                <div class="card-content p-6">
                                    <div class="flex items-center justify-between mb-4">
                                        <span class="px-2 py-1 text-xs rounded ${lesson.level === 'Beginner' ? 'bg-green-100 text-green-800' : lesson.level === 'Intermediate' ? 'bg-yellow-100 text-yellow-800' : 'bg-red-100 text-red-800'}">${lesson.level}</span>
                                        ${lesson.completed ? 
                                            '<div class="flex items-center gap-1 text-green-600"><i data-lucide="check-circle" class="size-4"></i><span class="text-xs">Completed</span></div>' : 
                                            lesson.started ? 
                                            '<div class="flex items-center gap-1 text-yellow-600"><i data-lucide="play-circle" class="size-4"></i><span class="text-xs">In Progress</span></div>' :
                                            '<div class="flex items-center gap-1 text-muted-foreground"><i data-lucide="circle" class="size-4"></i><span class="text-xs">Not Started</span></div>'
                                        }
                                    </div>
                                    <h3 class="font-semibold mb-2">${lesson.title}</h3>
                                    <p class="text-sm text-muted-foreground mb-4">${lesson.description}</p>
                                    <div class="flex items-center justify-between text-xs text-muted-foreground mb-4">
                                        <span><i data-lucide="clock" class="size-3 mr-1"></i>${lesson.readTime}</span>
                                        <span><i data-lucide="help-circle" class="size-3 mr-1"></i>${lesson.questions} questions</span>
                                        ${lesson.score ? `<span><i data-lucide="star" class="size-3 mr-1"></i>${lesson.score}%</span>` : '<span><i data-lucide="star" class="size-3 mr-1"></i>--</span>'}
                                    </div>
                                    ${lesson.progress ? `
                                        <div class="mb-4">
                                            <div class="flex justify-between text-xs mb-1">
                                                <span>Progress</span>
                                                <span>${lesson.progress}%</span>
                                            </div>
                                            <div class="w-full bg-muted rounded-full h-2">
                                                <div class="bg-primary h-2 rounded-full" style="width: ${lesson.progress}%"></div>
                                            </div>
                                        </div>
                                    ` : ''}
                                    <button class="btn ${lesson.completed ? 'btn-outline' : 'btn-primary'} w-full group-hover:bg-primary group-hover:text-primary-foreground transition-colors">
                                        <i data-lucide="${lesson.completed ? 'eye' : lesson.started ? 'play' : 'book-open'}" class="size-4 mr-2"></i>
                                        ${lesson.completed ? 'Review' : lesson.started ? 'Continue' : 'Start Reading'}
                                    </button>
                                </div>
                            </div>
                        `).join('')}
                    </div>

                    <!-- Recommended for You -->
                    <div class="mt-8">
                        <h3 class="text-lg font-semibold mb-4">Recommended for You</h3>
                        <div class="card bg-gradient-to-r from-primary/5 to-secondary/5 border-primary/20">
                            <div class="card-content p-6">
                                <div class="flex items-center gap-4">
                                    <div class="w-16 h-16 rounded-full bg-primary/20 flex items-center justify-center">
                                        <i data-lucide="brain" class="size-8 text-primary"></i>
                                    </div>
                                    <div class="flex-1">
                                        <h4 class="font-semibold mb-1">Advanced Scientific Texts</h4>
                                        <p class="text-sm text-muted-foreground mb-3">Based on your performance, we recommend trying more challenging scientific articles to improve your comprehension skills.</p>
                                        <button class="btn btn-secondary btn-sm">
                                            <i data-lucide="arrow-right" class="size-3 mr-1"></i>
                                            Explore Advanced
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }

            getTeacherLessons() {
                return [
                    {
                        id: 1,
                        title: "Climate Change and Environment",
                        description: "Comprehensive text about environmental challenges and solutions for intermediate learners.",
                        level: "Intermediate",
                        readTime: "8 min",
                        questions: 12,
                        students: 28,
                        topic: "science"
                    },
                    {
                        id: 2,
                        title: "The History of Space Exploration",
                        description: "Journey through mankind's greatest achievements in space technology and exploration.",
                        level: "Advanced",
                        readTime: "12 min",
                        questions: 15,
                        students: 15,
                        topic: "science"
                    },
                    {
                        id: 3,
                        title: "Introduction to Poetry",
                        description: "Basic concepts of poetry, rhyme, and literary devices for beginners.",
                        level: "Beginner",
                        readTime: "5 min",
                        questions: 8,
                        students: 32,
                        topic: "literature"
                    },
                    {
                        id: 4,
                        title: "World War II: Key Events",
                        description: "Major battles and turning points that shaped the outcome of the Second World War.",
                        level: "Intermediate",
                        readTime: "10 min",
                        questions: 14,
                        students: 22,
                        topic: "history"
                    },
                    {
                        id: 5,
                        title: "Modern Technology Trends",
                        description: "Exploring artificial intelligence, robotics, and their impact on society.",
                        level: "Advanced",
                        readTime: "9 min",
                        questions: 11,
                        students: 18,
                        topic: "current-events"
                    },
                    {
                        id: 6,
                        title: "Daily Life and Routines",
                        description: "Simple text about everyday activities and common expressions.",
                        level: "Beginner",
                        readTime: "4 min",
                        questions: 6,
                        students: 45,
                        topic: "general"
                    }
                ];
            }

            getStudentLessons() {
                return [
                    {
                        id: 1,
                        title: "Climate Change and Environment",
                        description: "Learn about environmental challenges and solutions.",
                        level: "Intermediate",
                        readTime: "8 min",
                        questions: 12,
                        completed: true,
                        score: 92,
                        topic: "science"
                    },
                    {
                        id: 2,
                        title: "The History of Space Exploration",
                        description: "Discover mankind's journey to the stars.",
                        level: "Advanced",
                        readTime: "12 min",
                        questions: 15,
                        started: true,
                        progress: 60,
                        topic: "science"
                    },
                    {
                        id: 3,
                        title: "Introduction to Poetry",
                        description: "Learn the basics of poetry and literary devices.",
                        level: "Beginner",
                        readTime: "5 min",
                        questions: 8,
                        completed: true,
                        score: 88,
                        topic: "literature"
                    },
                    {
                        id: 4,
                        title: "World War II: Key Events",
                        description: "Major battles that shaped world history.",
                        level: "Intermediate",
                        readTime: "10 min",
                        questions: 14,
                        started: false,
                        topic: "history"
                    },
                    {
                        id: 5,
                        title: "Modern Technology Trends",
                        description: "AI, robotics, and their impact on society.",
                        level: "Advanced",
                        readTime: "9 min",
                        questions: 11,
                        started: false,
                        topic: "current-events"
                    },
                    {
                        id: 6,
                        title: "Daily Life and Routines",
                        description: "Everyday activities and common expressions.",
                        level: "Beginner",
                        readTime: "4 min",
                        questions: 6,
                        completed: true,
                        score: 95,
                        topic: "general"
                    }
                ];
            }

            bindEvents() {
                // Teacher events
                if (this.currentUser.role === 'teacher') {
                    const createBtn = document.getElementById('create-lesson');
                    const importBtn = document.getElementById('import-text');
                    const aiBtn = document.getElementById('ai-generate');
                    const bulkBtn = document.getElementById('bulk-upload');

                    if (createBtn) createBtn.addEventListener('click', () => this.createLesson());
                    if (importBtn) importBtn.addEventListener('click', () => this.importText());
                    if (aiBtn) aiBtn.addEventListener('click', () => this.aiGenerate());
                    if (bulkBtn) bulkBtn.addEventListener('click', () => this.bulkUpload());
                }

                // Student events
                if (this.currentUser.role === 'student') {
                    const difficultyFilter = document.getElementById('difficulty-filter');
                    const topicFilter = document.getElementById('topic-filter');

                    if (difficultyFilter) difficultyFilter.addEventListener('change', () => this.filterLessons());
                    if (topicFilter) topicFilter.addEventListener('change', () => this.filterLessons());
                }

                // Global lesson events
                window.startLesson = (id) => this.startLesson(id);
                window.editLesson = (id) => this.editLesson(id);
                window.deleteLesson = (id) => this.deleteLesson(id);
                window.viewResults = (id) => this.viewResults(id);
            }

            // Teacher methods
            createLesson() {
                Navigation.showNotification('Opening lesson creator...', 'info');
                // In real app, would open lesson creation modal/page
            }

            importText() {
                Navigation.showNotification('Opening text import dialog...', 'info');
                // In real app, would open file import dialog
            }

            aiGenerate() {
                Navigation.showNotification('Generating lesson with AI...', 'info');
                // In real app, would open AI generation interface
            }

            bulkUpload() {
                Navigation.showNotification('Opening bulk upload interface...', 'info');
                // In real app, would open bulk upload dialog
            }

            editLesson(id) {
                Navigation.showNotification(`Editing lesson ${id}...`, 'info');
                // In real app, would open lesson editor
            }

            deleteLesson(id) {
                if (confirm('Are you sure you want to delete this lesson?')) {
                    Navigation.showNotification(`Lesson ${id} deleted`, 'success');
                    // In real app, would delete lesson from backend
                }
            }

            viewResults(id) {
                Navigation.showNotification(`Viewing results for lesson ${id}...`, 'info');
                // In real app, would show analytics/results page
            }

            // Student methods
            startLesson(id) {
                Navigation.showNotification(`Starting lesson ${id}...`, 'info');
                // In real app, would navigate to lesson reader
            }

            filterLessons() {
                const difficultyFilter = document.getElementById('difficulty-filter').value;
                const topicFilter = document.getElementById('topic-filter').value;
                
                Navigation.showNotification(`Filtering by ${difficultyFilter} difficulty and ${topicFilter} topic`, 'info');
                // In real app, would filter and re-render lessons
            }
        }

        // Initialize reading page
        document.addEventListener('DOMContentLoaded', () => {
            new ReadingPage();
        });
    </script>
</body>
</html>